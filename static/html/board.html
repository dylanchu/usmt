<!doctype html>
<html>

<head>
    <title>Demo &raquo; Serialize &raquo; gridster.js</title>
    <link rel="stylesheet" type="text/css" href="../css/demo.css">
    <link rel="stylesheet" type="text/css" href="../libs/gridster/jquery.gridster.min.css">
    <script src="../libs/jquery/1.7.1/jquery.min.js"></script>
    <script src="../libs/gridster/jquery.gridster.min.js" type="text/javascript" charset="utf-8"></script>

    <style type="text/css">
        #log {
            display: block;
            width: 100%;
            height: 20px;
            margin-bottom: 20px;

            -webkit-transition: height 0.3s ease;
            -moz-transition: height 0.3s ease;
            -ms-transition: height 0.3s ease;
            -o-transition: height 0.3s ease;
            transition: height 0.3s ease;
        }

        #log:focus {
            height: 100px;
        }
    </style>
</head>

<body>
    <div class="controls">
        <h4>Serialize returns a Array of objects that can be used as a JSON object.</h4>
        <button class="js-seralize">序列化坐标和内部文本</button>
    </div>

    <textarea id="log"></textarea>

    <div class="gridster">
        <ul>
            <li data-row="1" data-col="1" data-sizex="1" data-sizey="1">Hello</li>
            <li data-row="1" data-col="3" data-sizex="1" data-sizey="2">1</li>
            <li data-row="1" data-col="4" data-sizex="1" data-sizey="1">2</li>
            <li data-row="3" data-col="2" data-sizex="3" data-sizey="1">3</li>

            <li data-row="4" data-col="1" data-sizex="1" data-sizey="1">4</li>
            <li data-row="3" data-col="1" data-sizex="1" data-sizey="1">5</li>
            <li data-row="4" data-col="2" data-sizex="1" data-sizey="1">6</li>
            <li data-row="5" data-col="2" data-sizex="1" data-sizey="1">7</li>
            <li data-row="4" data-col="4" data-sizex="1" data-sizey="1">8</li>

            <li data-row="1" data-col="5" data-sizex="1" data-sizey="3">9</li>
        </ul>
    </div>

    <script type="text/javascript">
        var gridster;

        $(function () {

            gridster = $(".gridster ul").gridster({
                widget_base_dimensions: [200, 140],
                widget_margins: [8, 8],
                shift_widgets_up: false,
                shift_larger_widgets_down: false,
                collision: {
                    wait_for_mouseup: true
                },
            }).data('gridster');


            // $('.js-seralize').on('click', function () {
            //     var s = gridster.serialize();
            //     $('#log').val(JSON.stringify(s));
            // })

            $('.js-seralize').on('click', function () {
                s = []
                gridster.$widgets.each(function (i) { // map格式存储，i只是index
                    let w = gridster.$widgets[i]
                    let arr = gridster.serialize($(w))
                    arr[0].text = w.textContent
                    s = s.concat(arr)
                })
                $('#log').val(JSON.stringify(s));
            })

        });
    </script>
</body>

</html>